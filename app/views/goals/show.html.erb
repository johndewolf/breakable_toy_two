<div class="row">
  <div class="small-12 columns">
    <h1><%= @goal.title %></h1>
    <table>
      <tr>
        <thead>
          <th>Title</th>
          <th>Starting Point</th>
          <th>Target</th>
          <th>Goal Date</th>
        </thead>
      </tr>
      <tr>
        <td><%= @goal.title %></td>
        <td><%= pluralize("%g" % ("%.2f" % @goal.starting_point),
                @goal.unit_of_measurement) %></td>
        <td><%= pluralize("%g" % ("%.2f" % @goal.target),
                @goal.unit_of_measurement) %></td>
        <td><%= @goal.end_date.strftime("%B %d, %Y") %></td>
      </tr>
    </table>
  </div>
</div>
<% if @goal.completed_on != nil %>
  <h3>Congrats!</h3>
  <p>You hit your goal now do some dancing</p>
  <%= render 'goals_checkpoints' %>
<% elsif @goal.end_date_has_passed? %>
  <h3>You're end date for the goal has passed.</h3>
    <h3>Checkpoints:</h3>
    <table>
      <tr>
        <thead>
          <th>Complete By:</th>
          <th>Target</th>
          <th>User input</th>
        </thead>
      </tr>
        <% @goal.checkpoints.each do |checkpoint| %>
          <tr>
            <td><%= checkpoint.complete_by.strftime("%B %d, %Y") %></td>
            <td><%= "%g" % ("%.2f" % checkpoint.target) %></td>
            <td><%= "%g" % ("%.2f" % checkpoint.user_input) %></td>
          </tr>
        <% end %>
    </table>
<% else %>
  <div class="row">
   <div class="small-12 columns">
      <h3>Checkpoints:</h3>
        <table>
          <tr>
            <thead>
              <th>Complete By:</th>
              <th>Target</th>
              <th>User input</th>
            </thead>
          </tr>
            <% @checkpoints.each do |checkpoint| %>
              <tr>
                <td><%= checkpoint.complete_by.strftime("%B %d, %Y") %></td>
                <td><%= "%g" % ("%.2f" % checkpoint.target) %></td>
                <% unless checkpoint == @goal.checkpoints.last %>
                  <td><%= "%g" % ("%.2f" % checkpoint.user_input) %></td>
                <% end %>
              </tr>
            <% end %>
              <tr align="center"><td COLSPAN=3><%= link_to 'Update Checkpoint',
              edit_goal_checkpoint_path(@goal, @goal.checkpoints.last) %></td></tr>
         </table>
        <%= will_paginate @checkpoints %>
    </div>
  </div>
<% end %>
<div id="checkpoints-graph">
  <%= jqplot 400, "100%", [@goal.checkpoints.map{|t| t.user_input},
                            @goal.checkpoints.map{|t| t.target}],
            axes: {
              xaxis: {min: 0, max: @goal.checkpoints.count}, label: 'test'
              },
            grid: {
              shadow: false
              } %>
</div>

<p></p>
<% if @goal.user == current_user && @goal.completed_on == nil %>
  <%= link_to 'Edit', edit_goal_path(@goal) %> |
  <%= link_to 'Delete Goal', goal_path(@goal), method: :delete %> |
<% end %>
<%= link_to 'Back To User', user_path(@user) %>

